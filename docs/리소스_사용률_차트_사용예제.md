# 리소스 사용률 시각화 사용 예제

## 기본 사용법

다음은 리소스들의 시간에 대한 사용률을 선형 차트로 생성하는 기본적인 방법입니다:

### 1. 기본 설정

```python
import simpy
from src.core.report_manager import create_report_manager
from src.Resource.machine import Machine

# SimPy 환경 생성
env = simpy.Environment()

# ReportManager 생성 (시각화 기능 포함)
report_manager = create_report_manager(env)
```

### 2. 리소스 등록

```python
# 기계 리소스 생성
machine1 = Machine(env=env, resource_id="machine_01", name="가공기계1", capacity=1)
machine2 = Machine(env=env, resource_id="machine_02", name="가공기계2", capacity=1)

# ReportManager에 등록
report_manager.register_resource("machine_01", machine1)
report_manager.register_resource("machine_02", machine2)
```

### 3. 시뮬레이션 실행 (사용률 데이터 수집)

```python
# 시뮬레이션 프로세스에서 주기적으로 상태 추적
def track_resources(env, report_manager):
    while True:
        # 모든 등록된 리소스 상태 추적
        for resource_id in report_manager.resource_tracker.resource_registry:
            report_manager.resource_tracker.track_resource_state(resource_id)
        yield env.timeout(10)  # 10시간마다 추적

# 프로세스 시작
env.process(track_resources(env, report_manager))
env.run(until=200)  # 200시간 실행
```

### 4. 사용률 타임라인 차트 생성

```python
# 모든 리소스의 사용률 변화를 선형 차트로 표시
chart_path = report_manager.generate_utilization_timeline_chart(
    hours=24,  # 최근 24시간 데이터
    save_path="resource_utilization_timeline.png",
    title="리소스 사용률 변화 추이"
)
```

### 5. 특정 리소스만 선택하여 차트 생성

```python
# 특정 리소스들만 비교
selected_resources = ["machine_01", "machine_02"]
comparison_chart = report_manager.compare_resource_utilization_trends(
    resource_ids=selected_resources,
    hours=12,
    save_path="machine_comparison.png"
)
```

## 고급 활용

### 실시간 모니터링

```python
def real_time_monitoring(env, report_manager):
    """실시간으로 사용률 차트를 업데이트"""
    chart_count = 0
    
    while True:
        if env.now > 50:  # 충분한 데이터가 쌓인 후
            chart_count += 1
            
            # 타임라인 차트 생성
            report_manager.generate_utilization_timeline_chart(
                hours=24,
                save_path=f"realtime_chart_{chart_count:03d}.png",
                show_chart=False  # 화면에 표시하지 않고 저장만
            )
            
            # 현재 사용률 막대 차트
            report_manager.generate_real_time_utilization_chart(
                save_path=f"current_utilization_{chart_count:03d}.png"
            )
            
        yield env.timeout(30)  # 30시간마다 차트 업데이트

# 실시간 모니터링 시작
env.process(real_time_monitoring(env, report_manager))
```

### 커스텀 차트 생성

```python
# 원시 데이터 추출
timeline_data = report_manager.extract_resource_utilization_timeline(
    resource_ids=["machine_01", "machine_02"],
    hours=48
)

# 데이터 구조: {resource_id: [(time, utilization), ...]}
for resource_id, data_points in timeline_data.items():
    print(f"{resource_id}: {len(data_points)}개 데이터 포인트")
    for time_point, utilization in data_points[-5:]:  # 최근 5개
        print(f"  시간 {time_point:.1f}: 사용률 {utilization:.1%}")

# VisualizationManager로 직접 차트 생성
time_points = sorted(set([t for data in timeline_data.values() for t, _ in data]))
utilization_series = {}

for resource_id, data_points in timeline_data.items():
    util_dict = {t: u for t, u in data_points}
    utilization_series[resource_id] = [util_dict.get(t, 0) for t in time_points]

# 다중 선형 차트 생성
report_manager.visualization_manager.plot_multi_line_chart(
    time_data=time_points,
    data_series=utilization_series,
    title="커스텀 리소스 사용률 차트",
    x_label="시뮬레이션 시간",
    y_label="사용률",
    save_path="custom_utilization_chart.png"
)
```

## 출력 예시

```
=== 리소스 사용률 요약 ===
리소스 machine_01:
  - 평균 사용률: 73.2%
  - 최대 사용률: 95.8%
  - 최소 사용률: 15.4%
  - 현재 사용률: 81.3%
  - 데이터 포인트 수: 48

리소스 machine_02:
  - 평균 사용률: 65.7%
  - 최대 사용률: 89.1%
  - 최소 사용률: 22.1%
  - 현재 사용률: 68.9%
  - 데이터 포인트 수: 48
==============================
```

## 생성되는 차트 파일

- **타임라인 차트** (`resource_utilization_timeline.png`): 시간에 따른 각 리소스의 사용률 변화를 선형 그래프로 표시
- **비교 차트** (`resource_comparison.png`): 선택한 리소스들의 사용률 트렌드 비교
- **실시간 차트** (`current_utilization.png`): 현재 시점의 모든 리소스 사용률을 막대 그래프로 표시

모든 차트는 `visualizations/` 폴더에 고해상도(300 DPI)로 저장됩니다.

## 주의사항

1. **데이터 수집**: 리소스 상태를 주기적으로 추적해야 의미 있는 차트가 생성됩니다.
2. **충분한 시뮬레이션 시간**: 사용률 패턴을 보려면 충분한 시간 동안 시뮬레이션을 실행해야 합니다.
3. **메모리 관리**: 장시간 시뮬레이션 시 히스토리 데이터가 누적되므로 필요시 `max_history` 파라미터를 조정하세요.

이 기능을 통해 제조 시스템의 리소스 효율성을 시각적으로 분석하고 병목 지점을 쉽게 식별할 수 있습니다.
